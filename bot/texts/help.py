from __future__ import annotations

import html

from bot.ui.labels import label_quoted


def build_help_text(bot_username: str) -> str:
    deep_link = html.escape(f"https://t.me/{bot_username}?start=register")
    return (
        "<b>Гайд по боту — всё по шагам</b>\n\n"
        "<b>Что делает бот</b>\n"
        "• Регистрирует игроков клана.\n"
        "• Показывает профиль и статистику.\n"
        "• Помогает бронировать цели на КВ/ЛВК.\n"
        "• Отправляет уведомления в чат и в ЛС.\n"
        "• Принимает жалобы и отправляет их админам.\n\n"
        "<b>Как зарегистрироваться</b>\n"
        f"1) Нажмите кнопку {label_quoted('register')}.\n"
        "2) Введите player tag.\n"
        "3) Введите API token (только в ЛС).\n\n"
        "<b>Где взять player tag</b>\n"
        "Откройте профиль игрока в игре — тег выглядит как #ABC123.\n\n"
        "<b>Где взять API token</b>\n"
        "Нужно зайти в настройки в игре, далее в дополнительные настройки, и там снизу будет "
        "этот токен для регистрации.\n\n"
        "<b>Если вы начали в группе</b>\n"
        f"Откройте ЛС с ботом по ссылке: {deep_link}\n\n"
        "<b>Как работают цели на войне</b>\n"
        "• Во время подготовки ставьте флажок в игре и выбирайте противника в боте — цель закрепится за вами.\n"
        f"• Если кто-то атаковал вашу цель — нажмите кнопку {label_quoted('complaint')}.\n\n"
        "<b>Как работают уведомления</b>\n"
        f"Нажмите кнопку {label_quoted('notifications')} и выберите нужные переключатели.\n"
        "Уведомления могут приходить в чат или в ЛС. В режиме «только днём» ЛС приходят с 8:00 до 22:00.\n\n"
        f"<b>Как работает кнопка {label_quoted('complaint')}</b>\n"
        f"• Нажмите кнопку {label_quoted('complaint')}.\n"
        "• Выберите игрока клана из списка.\n"
        "• Напишите текст — жалоба уйдёт админам.\n\n"
        "<b>Что такое авто-предупреждения</b>\n"
        "Если игрок атаковал цель ниже себя более чем на 10 позиций, бот отправит предупреждение в ЛС.\n"
        "Админы увидят такую жалобу как «Предупреждение».\n\n"
        "<b>Где смотреть правила клана</b>\n"
        f"Нажмите кнопку {label_quoted('rules')} в главном меню.\n\n"
        "<b>Что может админ</b>\n"
        "• Настраивать уведомления и напоминания для общего чата.\n"
        "• Смотреть список пользователей.\n"
        "• Управлять жалобами.\n"
        "• Помогать с целями на войне.\n\n"
        "Глава клана и разработчик бота: @kinklid"
    )
